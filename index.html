<script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAw4aqJDVXyPnwv4se7J_cmJVbnwRw6gYw",
            authDomain: "creactivepackweb.firebaseapp.com",
            projectId: "creactivepackweb",
            storageBucket: "creactivepackweb.firebasestorage.app",
            messagingSenderId: "100899007718",
            appId: "1:100899007718:web:ea20959af8421e756b9f27"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // --- LÓGICA GLOBAL ---
        window.cart = [];
        const WHATSAPP_NUMBER = "8094190246";

        window.showView = (v) => {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('view-active'));
            document.getElementById('view-' + v).classList.add('view-active');
        };

        window.addToCart = (name, price) => {
            window.cart.push({name, price});
            document.getElementById('count').innerText = window.cart.length;
            alert("¡Añadido!");
        };

        window.recalcularTotales = () => {
            let sub = window.cart.reduce((acc, i) => acc + i.price, 0);
            let km = parseFloat(document.getElementById('distancia-km').value) || 0;
            let envio = km * 15;
            document.getElementById('subtotal-val').innerText = "RD$ " + sub;
            document.getElementById('envio-val').innerText = "RD$ " + envio;
            document.getElementById('total-val').innerText = "RD$ " + (sub + envio);
        };

        window.openCart = () => {
            if(window.cart.length === 0) return alert("Vacío");
            document.getElementById('cart-items').innerHTML = window.cart.map(i => `<div>${i.name} - RD$ ${i.price}</div>`).join('');
            window.recalcularTotales();
            document.getElementById('cart-modal').style.display = 'flex';
        };

        window.closeCart = () => document.getElementById('cart-modal').style.display = 'none';

        document.getElementById('btnFinalizar').onclick = async () => {
            const n = document.getElementById('name').value;
            const a = document.getElementById('address').value;
            const total = document.getElementById('total-val').innerText;

            if(!n || !a) return alert("Completa los datos");

            try {
                await addDoc(collection(db, "pedidos"), {
                    cliente: n,
                    direccion: a,
                    items: window.cart,
                    total: total,
                    fecha: serverTimestamp()
                });
                window.location.href = `https://wa.me/${WHATSAPP_NUMBER}?text=Hola, soy ${n}. Mi pedido es: ${total}`;
            } catch (e) { console.error(e); }
        };

        // Splash fade out
        window.onload = () => setTimeout(() => document.getElementById('splash').style.display = 'none', 2000);
    </script>
</body>
</html>
